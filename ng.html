<!DOCTYPE html>
<html lang="en">

<head>
    <title>Gallery of Glosses</title>
    <link rel="stylesheet" href="css/gloss.css">
    <link href="favicon.ico" rel="icon" type="image/x-icon" />
    <script src="js/auth.js" type="module"></script>
    <script src="js/deer.js" type="module"></script>
    <script src="js/layout.js" type="module"></script>
    <script src="js/witnessModal.js" type="module"></script>
    <script src="js/shared.js"></script>
    <script src="js/ng.js"></script>
</head>

<body class="container">
    <gog-header class="container"></gog-header>
    <h2> <span class="add-update">Add</span> Gloss </h2>
    <p class="bg-light">
        NB: A Gloss is an important thing. Please describe it as well as possible and
        avoid creating a new one unless it does not already exist.
    </p>
    <gog-references-browser class="bg-light is-hidden"> </gog-references-browser>
    <button class="addWitnessBtn button is-hidden" onclick="witnessForGloss(true)">Add a T-PEN Transcription Witness for this Gloss</button>
    <button class="addWitnessBtn button is-hidden" onclick="witnessForGloss()">Add a Textual Witness for this Gloss</button>
    <form id="named-gloss" deer-type="Gloss" deer-context="http://purl.org/dc/terms" hash-id>
        <input type="hidden" deer-key="targetCollection" value="GoG-Named-Glosses">
        <input is="auth-creator" type="hidden" deer-key="creator" />
        <div class="row">
            <label class="col-3 col-2-md text-right">Gloss Text:</label>
            <textarea custom-text-key="text" id="glossText" placeholder="text content" rows="2" class="col-9 col-10-md"></textarea>

            <label for="textLang" class="col-3 col-2-md text-right">Language:</label>
            <select custom-text-key="language" name="textLang" id="textLang" class="col-3 col-2-md">
                <option value="la" selected>Latin</option>
                <option value="de">German</option>
                <option value="fr">French</option>
                <option value="en">English</option>
            </select>

            <label title="Select the checkbox if the text contains markup tags like HTML or XML" class="col-12 col-6-md text-left">
                The text contains <code>&lt; tags &gt;</code><input type="checkbox" custom-text-key="format" value="text/plain" />
            </label>
        </div>
        <div class="row">
            <label class="col-3 col-2-md text-right">Description:</label>
            <input type="text" deer-key="description" placeholder="description" class="col-9 col-10-md">
            <label class="col-3 col-2-md text-right">Canonical Reference Locator:</label>
            <input type="text" deer-key="canonicalReference" placeholder='e.g., "Matthew 5:1"' class="col-9 col-4-md">
            <button class="col-6" type="button" role="button" onclick="parseSections()">parse sections</button>
            <label class="col-3 col-2-md text-right">Document:</label>
            <input type="text" deer-key="_document" placeholder='e.g., "Matthew"' class="col-9 col-4-md">
            <label class="col-3 col-2-md text-right">Section:</label>
            <input type="text" deer-key="_section" placeholder="chapter" class="col-9 col-4-md">
            <label class="col-3 col-2-md text-right">Subsection(s):</label>
            <input type="text" deer-key="_subsection" placeholder="verse" class="col-9 col-4-md">
        </div>
        <div class="row">
            <label class="col-3 col-2-md text-right">Target Text:</label>
            <textarea deer-key="targetedText" rows="2" class="col-9 col-10-md" placeholder="target text"></textarea>
            <label class="col-3 col-2-md text-right">Label for display:</label>
            <input type="text" deer-key="title" placeholder="Short label" class="col-9 col-10-md">
        </div>
        <div class="row">
            <label class="col-3 col-2-md text-right">Notes</label>
            <input type="text" deer-key="_notes" placeholder="internal notes" class="col-9 col-10-md">
        </div>
        <div class="row">
            <gog-tag-widget class="col"> </gog-tag-widget>
            <gog-theme-widget class="col"> </gog-theme-widget>
        </div>
        <div class="row">
            <div class="col">
                <p> Before submitting you can check for existing Glosses that may already contain the text provided above. </p>
                <button type="button" id="checkForGlossesBtn"> Check for Existing Glosses </button>
                <div id="glossResult"></div>
            </div>
        </div>
        <input type="submit" value="Create" class="col add-update">
        <a href="./glosses.html" onclick="removeFromCollectionAndDelete(event, 'named-gloss')"
            class="text-error">Drop from collection</a>
    </form>

    <gog-footer class="row"></gog-footer>
    <div id="globalFeedback" class="card is-center"></div>
    <witness-modal class="is-hidden"></witness-modal>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
    // Function to replace "undefined" or undefined with an empty string
        function stripUndefinedFromValue(element) {
            if (element && (element.value === "undefined" || typeof element.value === "undefined")) {
                element.value = '';
            }
        }

        function stripUndefinedFromInputs() {
            // Target the input fields by their 'deer-key' attributes
            const canonicalReferenceElem = document.querySelector('input[deer-key="canonicalReference"]');
            const documentElem = document.querySelector('input[deer-key="_document"]');

            // Strip "undefined" from the value attributes of the targeted input fields
            stripUndefinedFromValue(canonicalReferenceElem);
            stripUndefinedFromValue(documentElem);
        }

        // Initially strip "undefined" during DOMContentLoaded
        stripUndefinedFromInputs();

        // Strip "undefined" again when any form in the page is rendered
        document.addEventListener('deer-form-rendered', stripUndefinedFromInputs);
    });
    </script>
</body>

</html>